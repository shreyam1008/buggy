<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>English ↔ Nepali Date Converter</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: sans-serif;
        padding: 1rem;
        max-width: 420px;
        margin: auto;
      }
      input {
        width: 100%;
        font-size: 1.15rem;
        padding: 0.5rem;
        margin: 0.5rem 0;
        box-sizing: border-box;
      }
      label {
        font-weight: bold;
      }
      .hint {
        font-size: 0.9rem;
        color: #555;
        margin-bottom: 0.5rem;
      }
      header {
        text-align: center;
        margin-bottom: 0.5rem;
      }
      footer {
        font-size: 0.85rem;
        color: #666;
        margin-top: 1rem;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <h2>English ↔ Nepali Date Converter</h2>
      <div class="hint">
        Paste or type date in either box — the other updates instantly.
      </div>
    </header>

    <label for="adInput">AD (MM/DD/YYYY)</label>
    <input id="adInput" placeholder="04/14/1943" autocomplete="off" />

    <label for="bsInput">BS (YYYY-MM-DD)</label>
    <input id="bsInput" placeholder="2000-01-01" autocomplete="off" />

    <footer>
      Works offline — save page to your tablet and add to home screen for quick
      access.
    </footer>

    <script>
      // --- Official BS Month Data (2000 – 2089) ---
      const bsMonthData = {
        2000: [30, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2001: [31, 31, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2002: [31, 31, 32, 31, 31, 30, 30, 29, 30, 29, 30, 30],
        2003: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2004: [30, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2005: [31, 31, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2006: [31, 31, 32, 31, 31, 30, 30, 29, 30, 29, 30, 30],
        2007: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2008: [30, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2009: [31, 31, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
        2010: [31, 31, 32, 31, 31, 30, 30, 29, 30, 29, 30, 30],
        2011: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2012: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2013: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2014: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2015: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2016: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2017: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2018: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2019: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2020: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2021: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2022: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2023: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2024: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2025: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2026: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2027: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2028: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2029: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2030: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2031: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2032: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2033: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2034: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2035: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2036: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2037: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2038: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2039: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2040: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2041: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2042: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2043: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2044: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2045: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2046: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2047: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2048: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2049: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2050: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2051: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2052: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2053: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2054: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2055: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2056: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2057: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2058: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2059: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2060: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2061: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2062: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2063: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2064: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2065: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2066: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2067: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2068: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2069: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2070: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2071: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2072: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2073: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2074: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2075: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2076: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2077: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2078: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2079: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2080: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2081: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2082: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2083: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2084: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2085: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2086: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
        2087: [31, 31, 31, 32, 31, 30, 29, 30, 30, 29, 30, 30],
        2088: [31, 31, 32, 31, 31, 30, 29, 30, 30, 29, 30, 30],
        2089: [31, 32, 31, 32, 31, 30, 29, 30, 29, 30, 29, 31],
      };

      const anchorAd = new Date(Date.UTC(1943, 3, 14)); // 1943-04-14
      const anchorBs = { y: 2000, m: 1, d: 1 };

      function convertAdToBs(adDate) {
        const diffDays = Math.floor((adDate - anchorAd) / 86400000);
        let y = anchorBs.y,
          m = anchorBs.m,
          d = anchorBs.d;
        let remain = diffDays;
        if (remain >= 0) {
          while (remain--) {
            d++;
            if (d > bsMonthData[y][m - 1]) {
              d = 1;
              m++;
              if (m > 12) {
                m = 1;
                y++;
              }
            }
          }
        } else {
          while (remain++) {
            d--;
            if (d < 1) {
              m--;
              if (m < 1) {
                y--;
                m = 12;
              }
              d = bsMonthData[y][m - 1];
            }
          }
        }
        return { y, m, d };
      }

      function convertBsToAd(y, m, d) {
        let adDate = new Date(anchorAd);
        let yy = anchorBs.y,
          mm = anchorBs.m,
          dd = anchorBs.d;
        while (yy < y || (yy === y && (mm < m || (mm === m && dd < d)))) {
          adDate = new Date(adDate.getTime() + 86400000);
          dd++;
          if (dd > bsMonthData[yy][mm - 1]) {
            dd = 1;
            mm++;
            if (mm > 12) {
              mm = 1;
              yy++;
            }
          }
        }
        while (yy > y || (yy === y && (mm > m || (mm === m && dd > d)))) {
          adDate = new Date(adDate.getTime() - 86400000);
          dd--;
          if (dd < 1) {
            mm--;
            if (mm < 1) {
              yy--;
              mm = 12;
            }
            dd = bsMonthData[yy][mm - 1];
          }
        }
        return adDate;
      }

      // fast parsing helpers & validation
      function isValidAdParts(y, m, d) {
        if (
          !Number.isInteger(y) ||
          !Number.isInteger(m) ||
          !Number.isInteger(d)
        )
          return false;
        if (m < 1 || m > 12) return false;
        const dt = new Date(Date.UTC(y, m - 1, d));
        return (
          dt.getUTCFullYear() === y &&
          dt.getUTCMonth() + 1 === m &&
          dt.getUTCDate() === d
        );
      }

      function isValidBsParts(y, m, d) {
        if (
          !Number.isInteger(y) ||
          !Number.isInteger(m) ||
          !Number.isInteger(d)
        )
          return false;
        if (y < 2000 || y > 2089) return false;
        if (m < 1 || m > 12) return false;
        return d >= 1 && d <= bsMonthData[y][m - 1];
      }

      const adInput = document.getElementById("adInput");
      const bsInput = document.getElementById("bsInput");

      // debounce to avoid heavy loops while typing; responsive but stable
      function debounce(fn, ms) {
        let t;
        return (...args) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...args), ms);
        };
      }

      adInput.addEventListener(
        "input",
        debounce(() => {
          const val = adInput.value.trim();
          const parts = val.split("/").map((s) => Number(s));
          if (parts.length !== 3) {
            if (val === "") bsInput.value = "";
            return;
          }
          const [mm, dd, yyyy] = parts;
          if (!isValidAdParts(yyyy, mm, dd)) return;
          const adDate = new Date(Date.UTC(yyyy, mm - 1, dd));
          const { y, m, d } = convertAdToBs(adDate);
          bsInput.value = `${y}-${String(m).padStart(2, "0")}-${String(
            d
          ).padStart(2, "0")}`;
        }, 120)
      );

      bsInput.addEventListener(
        "input",
        debounce(() => {
          const val = bsInput.value.trim();
          const parts = val.split("-").map((s) => Number(s));
          if (parts.length !== 3) {
            if (val === "") adInput.value = "";
            return;
          }
          const [yyyy, mm, dd] = parts;
          if (!isValidBsParts(yyyy, mm, dd)) return;
          const adDate = convertBsToAd(yyyy, mm, dd);
          adInput.value = `${String(adDate.getUTCMonth() + 1).padStart(
            2,
            "0"
          )}/${String(adDate.getUTCDate()).padStart(
            2,
            "0"
          )}/${adDate.getUTCFullYear()}`;
        }, 120)
      );
    </script>
  </body>
</html>
